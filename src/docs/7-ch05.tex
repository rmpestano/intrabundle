\chapter{Bundle Introspection Results}

Intrabundle was used to introspect and apply its metrics to 10 real OSGi projects, the projects are all open sourced and vary in size, teams and domain. 

\section{Analyzed Projects}
In this section is presented an overview of projects that were analyzed during this work. Table \ref{osgi-analyzed-projects} shows projects in terms of \emph{size}. We've chosen projects that vary in size, are from different organizations (Apache, Eclipse, etc), they solve different problems and are all open source.

\begin{table}[h]
\caption{OSGi projects analyzed by Intrabundle}
\label{osgi-analyzed-projects}
\begin{center}      
    \begin{tabular}{  p{3cm} | p{3cm} | p{3cm} | p{3cm} | p{3cm}}
    \Xhline{2\arrayrulewidth}
    Name & N\ts{o} of bundles & LoC & LoC/bundle& Analisys time(sec) \\ \hline
    \href{http://eclipse.org/birt/}{BIRT} & 129 (217) & 2,226,436 & 17,259 & 73.9\\ \hline
    \href{https://eclipse.org/webtools/dali/}{Dali} & 35 (46) & 1,058,160 & 30,233 & 56.9\\ \hline
    \href{https://jitsi.org/}{Jitsi} & 155 (158) & 607,144 & 3,917& 29.6\\ \hline
    \href{http://jonas.ow2.org/xwiki/bin/view/Main/}{JOnAS} & 117 (122) & 366,940 & 3,136&27.5\\ \hline
    \href{http://karaf.apache.org/}{Karaf} & 58 (60) & 93,743 & 1,616&8.6\\ \hline
    \href{http://www.openhab.org/}{Openhab} & 181 (184) & 347,492 & 1,919&23.2\\ \hline
    \href{https://eclipse.org/osee/}{OSEE} & 183 (190) & 873,690 & 4774&10.3\\ \hline
    \href{http://team.ops4j.org/wiki/display/paxcdi/}{Pax CDI} & 21 (22) & 19,480 & 927&2.5\\ \hline 
    \href{http://tuscany.apache.org/sca-overview.html}{Tuscany Sca} & 138 (140) & 243,494 & 1,764&23.2\\ \hline
    \href{http://www.eclipse.org/virgo/}{Virgo} & 36 (49) & 77,859 & 2,162&5.6\\ \hline
    Sum & 1051 & 4,962,094 & 4721 & 261.3(\textasciitilde{}4min) \\
   \Xhline{2\arrayrulewidth}

    \end{tabular}
\end{center}
\end{table}
\FloatBarrier 

Note that number of bundle in parenthesis is considering bundles with zero lines of code which, in the extent of this work, are not considered for quality analysis. Also note that lines of code is considering only .java files excluding comment lines.
Analysis time column is the time in seconds to extract data and generate reports using Intrabundle osgi-scan 12 command on the root directory of each projects. The environment the reports were generated was: Sony Vaio laptop eg series, Intel(R) Core(TM) i5-2410M CPU @ 2.30GHz, 4GB RAM, OS Ubuntu 12.04, Java version "1.7.0\_67".

Below is a brief description of each project:

\begin{enumerate}
\item \textbf{BIRT}: Is an open source software project that provides the BIRT technology platform to create data visualizations and reports that can be embedded into rich client and web applications, especially those based on Java and Java EE;
\item \textbf{Dali}: The Dali Java Persistence Tools Project provides extensible frameworks and tools for the definition and editing of Object-Relational (O/R) mappings for Java Persistence API (JPA) entities;
\item \textbf{Jitsi}: Is an audio/video Internet phone and instant messenger written in Java. It supports some of the most popular instant messaging and telephony protocols such as SIP, Jabber/XMPP (and hence Facebook and Google Talk), AIM, ICQ, MSN, Yahoo! Messenger;
\item \textbf{JOnAS}: Is a leading edge open source Java EE 6 Web Profile certified OSGi Enterprise Server;
\item \textbf{Karaf}: Apache Karaf is a small OSGi based runtime which provides a lightweight container onto which various components and applications can be deployed;
\item \textbf{Openhab}: An open source home automation software for integrating different home automation systems and technologies into one single solution that allows over-arching automation rules and that offers uniform user interfaces;
\item \textbf{OSEE}: The Open System Engineering Environment is an integrated, extensible tool environment for large engineering projects. It provides a tightly integrated environment supporting lean principles across a product's full life-cycle in the context of an overall system engineering approach;
\item \textbf{Pax CDI}: Brings the power of Context and Dependency Injection (CDI) to the OSGi platform; 
\item \textbf{Tuscany SCA}: Is a programming model for abstracting business functions as components and using them as building blocks to assemble business solutions; 
\item \textbf{Virgo}: Is a completely module-based Java application server that is designed to run enterprise Java applications and Spring-powered applications with a high degree of flexibility and reliability.
\end{enumerate}


\section{Projects Quality Results}
In this section will be presented the resulting qualities of analyzed projects and some comparisons. First comparison groups analyzed projects comparing their \emph{bundle quality} and \emph{metric quality}. Later the projects are separated by groups in terms of size of LoC and number of bundles.

All projects quality reports that provided data for all comparisons are available online, see \citep{intrabundle reports 2014} for detailed information. 

\subsection{General Quality Comparison}

The first table shows general projects qualities, it is ordered by quality points percentage. Its important to note that each projects maximum quality points (MQP) is different because it depends on the number of bundles, see \ref{sec:project-quality} for further information:

\begin{table}[h]
\caption{Projects general quality}
\label{projects-general-quality}
    \begin{tabular}{  p{3cm} | p{2cm} | p{2cm} | p{3cm} | p{4cm}}
    \Xhline{2\arrayrulewidth}
    Name & TQP & MQP & Points percent & Quality label \\  \hline
    Pax CDI & 84 & 105 & 80\% & Very Good\\ \hline 
    Openhab &   666 & 905 & 73.6\% & Good\\ \hline
    Virgo & 132 & 180 & 73.3\% & Good\\ \hline
    Karaf & 211 & 290 & 72.8\% & Good\\ \hline
    OSEE & 596 & 915 & 65.1\% & Good\\ \hline
    Tuscany Sca & 433 & 690 & 62.8\% & Good\\ \hline
    JOnAS & 356 & 585 & 60.9\%  & Good\\ \hline
    Jitsi & 414 & 775 & 53.4\% & Regular\\ \hline
    Dali & 86 & 175 & 49.1\%  & Regular\\ \hline
    BIRT & 315 & 645 & 48.8\% & Regular\\ 
   \Xhline{2\arrayrulewidth}
    \end{tabular}
\end{table}
\FloatBarrier 

The winner on general category, considering Intrabundle metrics, is \textbf{Pax CDI} project which obtained 80\% of quality points and received a \emph{Very Good quality label}. Pax CDI is a project from \emph{OPS4J - Open Participation Software for Java} which is a community that is trying to build a new, more open model for open source development, where not only the usage is ppen and free, but the participation is open as well. 

\subsection{Metrics Qualities Comparison}

The next category analyzes how good the projects are on each metric. It's important to note that each project \emph{maximum quality points} (MQP) in a metric depends on the number of bundles, see section \ref{sec:project-quality-metric} for more details. Values in table \ref{projects-metrics-quality} are the \emph{total quality points} (TQP) obtained. Values in parenthesis are the percentage of MQP of table values and after the parenthesis is the quality label that the percentage represents (as described in \ref{sec:project-quality-metric}):  

\begin{table}[h]
\tiny
\caption{Projects quality by metrics}
\label{projects-metrics-quality}
    \begin{tabular}{  p{1,5cm} | p{0,7cm} | p{2cm} | p{2cm} | p{2cm} | p{2cm} | p{2cm} | p{1,8cm} }
    \Xhline{2\arrayrulewidth}
    Name & MQP & LoC & Publishes interfaces & Uses framework & Bundle dependency & Stale references & Declares permission \\  \hline
    BIRT & 645 & 294 (45.6\%) regular & 393 (60.9\%) good& 258 (40\%) regular& 307 (47.6\%) regular& 644 (99.8\%) state of the art & 261 (40.5\%) regular\\ \hline
    Dali & 175 & 74 (42.3\%) regular & 175 (100\%) state of the art& 70 (40\%) regular & 65 (37.1\%) anti pattern. & 174 (99.4\%) state of the art& 70 (40\%) regular\\ \hline
    Jitsi & 775 & 492 (63.5\%) good & 775 (100\%) state of the art& 310 (40\%) regular& 459 (59.2\%) regular& 473 (61\%) good& 310 (40\%) regular\\ \hline
    JOnAS & 585 & 358 (61.2\%) good & 480 (82.1\%) very good& 252 (43.1\%) regular& 481 (82.2\%) very good& 573 (97.9\%) state of the art& 234 (40\%) regular\\ \hline
    Karaf & 290 & 212 (73.1\%) good & 257 (88.6\%) very good& 158 (54.5\%) regular&  290 (100\%) state of the art& 278 (95.9\%) state of the art& 116 (40\%) regular\\ \hline
    Openhab & 905 & 672 (74.3\%) good& 791 (87.4\%) very good& 806 (89.1\%) very good&  664 (73.4\%) good& 901 (99.6\%) state of the art& 362 (40\%) regular\\ \hline
    OSEE & 915 & 584 (63.8\%) good& 909 (99.3\%) state of the art& 573 (62.6\%) good& 529 (57.8\%) regular& 881 (96.3\%) state of the art& 366 (40\%) regular\\ \hline
    Pax CDI & 105 & 85 (81\%) very good & 105 (100\%) state of the art & 66 (62.9\%) good& 103 (98.1\%) state of the art & 98 (93.3\%) state of the art& 42 (40\%) regular\\ \hline
    Tuscany SCA & 690 & 472 (68.4\%) good& 684 (99.1\%) state of the art & 288 (41.7\%) regular& 451 (65.4\%) good&  682 (98.8\%) state of the art& 276 (40\%) regular\\ \hline
    Virgo & 180 & 127 (76.1\%) very good& 180 (100\%) state of the art & 78 (43.3\%) regular & 176 (97.8\%) state of the art& 162 (90\%) state of the art & 72 (40\%) regular\\ \hline
    Average  & & 64.9\% - good & 91.7\% - state of the art & 51.7\% - regular  & 71.8\% - good & 93.2\% - state of the art & 40.05\% - regular\\
   \Xhline{2\arrayrulewidth}
    \end{tabular}
\end{table}
\FloatBarrier   

Following are the champions on each metric:


\begin{itemize}
\item \emph{LoC}: Pax CDI has Very Good quality label on LoC;
\item \emph{Publishes interfaces}: Dali, Jitsi, Pax CDI and Virgo are all tied on metric points (100\%) and are labeled \emph{State of Art} on this metric;
\item \emph{Uses framework}: Openhab is \emph{Very Good} (almost State of the art) on this metric;
\item \emph{Bundle dependency}: Karaf is leading with 100\% and is \emph{State of the art} on this metric followed by Pax CDI and Virgo which are also State of the art (>=90\%) but not with 100\% of quality points;  
\item \emph{Stale references}: Birt is leading on this metric, it has only one (probably) stale reference class among its 2 million line of code. Openhab loses by 0.2\% with 2 stale references on its 300 thousands of lines of code.  
\item \emph{Declares permission}: Birt is the only analyzed project that has a bundle which declares permission.
\end{itemize}

Some interesting facts can be observed looking at table \ref{projects-metrics-quality}:

Birt was the only project to use OSGi permission mechanism among analyzed projects. In fact with \emph{40.5\%}\footnote{When a bundle does not declares permission it receives 2 metric points (regular label). So if a project has all bundles with regular label it will have 40\% of MQP.} means that only one Birt bundle declared permission which was \\\emph{org.eclipse.birt.report.engine.emitter.postscript}.

Eclipse Dali project has the worst \emph{dependency quality} metric which a sign that its bundles are high coupled, as opposed to Karaf which may have low coupled bundles.

Projects that \emph{use a framework} for managing services usually has less stale references because they are not likely to code for publish or consume service as a framework is doing that for them.

Jitsi has more \emph{Stale references} which may affect its \emph{reliability}. Although it has lots of stale references compared to other projects it received a \emph{Good} quality label which means that this metric formula is not well dimensioned and may be revisited in future.    

It looks like \emph{publishing only interfaces} for hiding implementation is a well known and disseminated good practice as we have good punctuation on this metric in most analyzed projects.  

We have evidences that \textbf{Pax CDI} has the more cohesive bundles as they have less lines of code then bundles of other projects. We may infer that most bundles are high cohesive as they receive good quality label on LoC metric.

Bundle coupling seen to be good among analyzed projects as the average quality on bundle dependency was good.

 
\subsection{Projects Qualities by Size}

In the tables below the projects are separated by size as we believe that comparing projects with large code base with minor sized projects is unfair. It is easier to keep good practices in new projects as opposed to bigger projects where teams are usually larger, a person hardly will know every detail, multiple versions are being worked in parallel and so on.  In this section we separate analyzed projects by LoC and number of bundles. Table \ref{projects-quality-bundle} separates projects by bundles where small projects range from 0 to 100 bundles and large projects has more then 100 bundles.


\begin{table}[htbp]
  \small
  \caption{Projects qualities by number of bundles}
  \label{projects-quality-bundle}
  \subfloat[Less then 100 bundles]{%
    \hspace{.5cm}%
   \begin{tabular}{  p{2,5cm} | p{2cm} | p{2cm} | p{2,6cm} | p{2cm} | p{2,3cm}}
    \Xhline{2\arrayrulewidth}
    Name & TQP & MQP & Points percent & Quality label & N\ts{o} of Bundles \\  \hline
    Pax CDI & 84 & 105 & 80\% & Very Good & 21\\ \hline 
    Virgo & 132 & 180 & 73.3\% & Good & 36\\ \hline 
    Karaf & 211 & 290 & 72.8\% & Good & 58\\ \hline
    Dali & 86 & 175 & 49.1\% & Regular & 35\\ 
   \Xhline{2\arrayrulewidth}
    \end{tabular}
    \hspace{.5cm}%
  }\hspace{1cm}
  \subfloat[100 or more bundles]{%
    \hspace{.5cm}%
    \begin{tabular}{  p{2,5cm} | p{2cm} | p{2cm} | p{2,6cm} | p{2cm} | p{2,3cm}}
    \Xhline{2\arrayrulewidth}
    Name & TQP & MQP & Points percent & Quality label & N\ts{o} of Bundles \\  \hline
    Openhab &   666 & 905 & 73.6\% & Good & 181\\ \hline
    OSEE & 596 & 915 & 65.1\% & Good & 183\\ \hline
    Tuscany Sca & 433 & 690 & 62.8\% & Good & 138 \\ \hline
    JOnAS & 356 & 585 & 60.9\%  & Good & 117\\ \hline
    Jitsi & 414 & 775 & 53.4\% & Regular & 155\\ \hline
    BIRT & 315 & 645 & 48.8\% & Regular & 129\\ 
   \Xhline{2\arrayrulewidth}
    \end{tabular}
    \hspace{.5cm}%
  }
\end{table}
\FloatBarrier  
For small projects there is no news, \emph{Pax CDI} still winning. For larger projects \textbf{Openhab} is the new champion with a good quality in large code base. It is also interesting to note that we have three small projects among the five first positions in the quality rank. 

The next table compares projects by LoC dividing them into small, medium and large sized. In this comparison small projects range from 0 to 100,000 lines of code, medium sized range from 100,001 to 500,000 LoC and large projects are the ones with more than half million lines of code:

\begin{table}[htbp]
  \small
  \caption{Projects qualities by number of LoC}
    \label{projects-quality-loc}
  \subfloat[Up to 100,000 LoC]{%
    \hspace{.5cm}%
   \begin{tabular}{  p{2,5cm} | p{2cm} | p{2cm} | p{2,7cm} | p{2cm} | p{2,5cm}}
    \Xhline{2\arrayrulewidth}
    Name & TQP & MQP & Points percent & Quality label & LoC  \\  \hline
    Pax CDI & 84 & 105 & 80\% & Very Good& 19,480\\ \hline 
    Virgo & 132 & 180 & 73.3\% & Good & 77,859\\ \hline 
    Karaf & 211 & 290 & 72.8\% & Good & 93,743\\ 
   \Xhline{2\arrayrulewidth}
    \end{tabular}
    \hspace{.5cm}%
  }\hspace{1cm}
  \subfloat[Between 100,001 and 500,00 LoC]{%
    \hspace{.5cm}%
    \begin{tabular}{  p{2,5cm} | p{2cm} | p{2cm} | p{2,7cm} | p{2cm} | p{2,5cm}}
    \Xhline{2\arrayrulewidth}
    Name & TQP & MQP & Points percent & Quality label & LoC  \\  \hline
    Openhab &   666 & 905 & 73.6\% & Good & 347,492\\ \hline
    Tuscany Sca & 433 & 690 & 62.8\% & Good & 243,494\\ \hline
    JOnAS & 356 & 585 & 60.9\%  & Good & 366,940\\ 
   \Xhline{2\arrayrulewidth}
   \end{tabular}
   \hspace{.5cm}%
   }\hspace{1cm}
   \subfloat[More then 500,00 LoC]{%
    \hspace{.5cm}%
    \begin{tabular}{  p{2,5cm} | p{2cm} | p{2cm} | p{2,7cm} | p{2cm} | p{2,5cm}}
    \Xhline{2\arrayrulewidth}
    Name & TQP & MQP & Points percent & Quality label & LoC \\  \hline
    OSEE & 596 & 915 & 65.1\% & Good & 873,690\\ \hline
    Jitsi & 414 & 775 & 53.4\% & Regular & 607,144\\ \hline
    Dali & 86 & 175 & 49.1\%  & Regular & 1,058,160\\ \hline
    BIRT & 315 & 645 & 48.8\% & Regular & 2,226,436\\ 
   \Xhline{2\arrayrulewidth}
    \end{tabular}
    \hspace{.5cm}%
  }
\end{table}
\FloatBarrier  
In small category there is no surprise, \textbf{Pax CDI} is still leading. \textbf{Openhab} is the king of medium projects and \textbf{OSSE} is the winner among the larger group. 

Note that the worse qualities are in larger projects as we expected. The two projects with more the one million LoC have the worst qualities measured by Intrabundle. The opposite is also valid and can be observed in small group table. 

\section{Results}
In this section we summarize the results obtained by Intrabundle in previous sections. 
The first thing to note is that Intrabundle could analyze big projects in a small amount of time. It analyzed more than 1000 bundles and almost 5 million lines of code and generated detailed reports in a few minutes.

We noted that smaller projects are easier to keep good practices and that reflected on the resulting qualities where the smaller projects were on the top. We also noted that good quality is possible in bigger projects, as proved by \emph{Openhab}.

Bundle cohesion seem to be good on most analyzed projects as they obtained good quality points on LoC metric.

Publishes Interfaces metric received the higher quality points and proved to be a very disseminated good practice among OSGi projects.

As opposed to Publishing only interfaces, the permission by contract is not being adopted in analyzed projects and received the worst punctuation.

Stale references metric was not well dimensioned as projects received good punctuation(State of the art) although Stale references were found on most projects. This metric is close related to memory leaks and system reliability but was too relaxed in comparison to its importance. 

About coupling, the bundle dependency metric showed that in most analyzed projects the bundles are low coupled. Most projects received \emph{Good} quality label on this metric.

Although using a framework for service management is a good practice, it is not so popular in projects we used as example. Maybe this metric need to be revisited because not all bundles publish or consume services.

